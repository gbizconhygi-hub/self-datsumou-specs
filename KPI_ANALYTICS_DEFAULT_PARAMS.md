# KPI_ANALYTICS_DEFAULT_PARAMS â€” KPIåˆ†æï¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾© v1.4

## 0. ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½ç½®ã¥ã‘

- æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ Phase6 è¦ç´  **KPI_ANALYTICS**ï¼ˆKPIé›†è¨ˆï¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰ã§åˆ©ç”¨ã™ã‚‹
    
    ã€Œé›†è¨ˆå˜ä½ãƒ»ã—ãã„å€¤ãƒ»è¡¨ç¤ºåˆ¶å¾¡ã€ã«é–¢ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¾¤ã‚’æ•´ç†ã—ãŸã‚‚ã®ã€‚
    
- å®Ÿä½“ã¯
    - `sys_params` ç³»ãƒ†ãƒ¼ãƒ–ãƒ«
    - ã¾ãŸã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
    ã¨ã—ã€æœ¬æ›¸ã¯è«–ç†ã‚­ãƒ¼åã¨æ„å‘³ãƒ»ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ç¤ºã™ã€‚
- ã“ã“ã§å®šç¾©ã™ã‚‹ã‚­ãƒ¼ã¯ã€
    - `PHASE_06_KPI_ANALYTICS.md` ã®ã€ŒğŸ”§ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€™è£œã€ã§æŒ™ã’ãŸå†…å®¹ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸ **ã‚³ã‚¢ã‚»ãƒƒãƒˆ** ã¨ã™ã‚‹ã€‚

---

## 1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸€è¦§ï¼ˆã‚³ã‚¢ï¼‰

### 1-1. é›†è¨ˆå˜ä½ãƒ»è¡¨ç¤ºç¯„å›²

### 1-1-1. `kpi_default_granularity`

- å‹: `string`ï¼ˆ`'daily'` / `'monthly'`ï¼‰
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: `'monthly'`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸè¡¨ç¤ºãƒ»é›†è¨ˆãƒãƒƒãƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç²’åº¦ã€‚
    - v1.4 ã§ã¯ `monthly` ã‚’æ¨™æº–ã¨ã—ã€`daily` ã¯å¿…è¦ã«å¿œã˜ã¦ã‚ªãƒ³ã«ã™ã‚‹ã€‚

---

### 1-1-2. `kpi_default_period_months`

- å‹: `int`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `3`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã„ãŸã¨ãã«è¡¨ç¤ºã™ã‚‹ **éå»ä½•ãƒ¶æœˆåˆ†** ã‚’æŒ‡ã™ã€‚
    - ä¾‹ï¼š3 â†’ ã€Œä»Šæœˆï¼‹éå»2ãƒ¶æœˆã€ã®åˆè¨ˆ3ãƒ¶æœˆè¡¨ç¤ºã€‚

---

### 1-1-3. `kpi_allow_daily`

- å‹: `bool`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: `false`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - æ—¥æ¬¡KPIé›†è¨ˆãƒ»è¡¨ç¤ºã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ã©ã†ã‹ã€‚
    - v1.4 åˆæœŸã¯ `false` ã¨ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚„ãƒ‹ãƒ¼ã‚ºæ¬¡ç¬¬ã§ `true` ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚

---

### 1-2. AIè‡ªå·±è§£æ±ºï¼å•ã„åˆã‚ã›é–¢é€£

### 1-2-1. `kpi_ai_good_resolution_threshold`

- å‹: `float`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `0.7`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - AIè‡ªå·±è§£æ±ºç‡ãŒã“ã®å€¤ä»¥ä¸Šãªã‚‰ã€Œè‰¯å¥½ã€ã¨è¡¨ç¤ºã™ã‚‹ã€‚
    - ä¾‹ï¼š0.7 â†’ 70%ä»¥ä¸Šã§è‰¯å¥½ã€‚

---

### 1-2-2. `kpi_ai_bad_resolution_threshold`

- å‹: `float`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `0.4`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - AIè‡ªå·±è§£æ±ºç‡ãŒã“ã®å€¤æœªæº€ãªã‚‰ã€Œè¦æ”¹å–„ã€ã¨è¡¨ç¤ºã™ã‚‹ã€‚

---

### 1-2-3. `kpi_customer_ticket_high_threshold`

- å‹: `int`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `50`ï¼ˆä¾‹ã¨ã—ã¦ï¼‰
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - 1æœŸé–“ã‚ãŸã‚Šã®é¡§å®¢ãƒã‚±ãƒƒãƒˆä»¶æ•°ãŒã“ã®å€¤ã‚’è¶…ãˆãŸå ´åˆã€
    ã€Œå•ã„åˆã‚ã›ãŒå¤šã„ã€åº—èˆ—ã¨ã—ã¦ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¸Šã§ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ã€‚

---

### 1-3. SLAï¼ã‚µãƒãƒ¼ãƒˆå“è³ªé–¢é€£

### 1-3-1. `kpi_sla_good_threshold`

- å‹: `float`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `0.9`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - SLAéµå®ˆç‡ãŒã“ã®å€¤ä»¥ä¸Šãªã‚‰ã€Œè‰¯å¥½ã€ã€‚

---

### 1-3-2. `kpi_sla_bad_threshold`

- å‹: `float`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `0.7`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - SLAéµå®ˆç‡ãŒã“ã®å€¤æœªæº€ãªã‚‰ã€Œè¦æ³¨æ„ã€ã€‚

---

### 1-3-3. `kpi_first_response_target_minutes`

- å‹: `int`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `60`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - åˆå›å¿œç­”ã¾ã§ã®ç›®æ¨™æ™‚é–“ï¼ˆåˆ†ï¼‰ã€‚
    - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€ç›®æ¨™å€¤ã¨ã®æ¯”è¼ƒã‚³ãƒ¡ãƒ³ãƒˆã«ä½¿ç”¨ã™ã‚‹ï¼ˆä¾‹ï¼šã€Œå¹³å‡45åˆ† â†’ ç›®æ¨™å†…ã€ï¼‰ã€‚

---

### 1-4. åˆæˆã‚¹ã‚³ã‚¢é–¢é€£

### 1-4-1. `kpi_score_sales_weight`

- å‹: `float`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `0.5`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - å£²ä¸Šç³»æŒ‡æ¨™ã‚’ `kpi_score_overall` ã«åæ˜ ã™ã‚‹éš›ã®é‡ã¿ã€‚

---

### 1-4-2. `kpi_score_support_weight`

- å‹: `float`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `0.5`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - å•ã„åˆã‚ã›ï¼AIï¼SLAç³»æŒ‡æ¨™ã‚’ `kpi_score_overall` ã«åæ˜ ã™ã‚‹éš›ã®é‡ã¿ã€‚

> kpi_score_sales_weight + kpi_score_support_weight = 1.0 ã‚’å‰æã¨ã™ã‚‹ã€‚
> 

---

### 1-4-3. `kpi_score_overall_good_threshold`

- å‹: `int`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `80`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - `kpi_score_overall` ãŒã“ã®å€¤ä»¥ä¸Šã®åº—èˆ—ã‚’ã€Œè‰¯å¥½ã€ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚

---

### 1-4-4. `kpi_score_overall_warning_threshold`

- å‹: `int`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `60`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - `kpi_score_overall` ãŒã“ã®å€¤æœªæº€ã®åº—èˆ—ã‚’ã€Œè¦æ³¨æ„ã€ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚
    - ä¾‹ï¼š
        - 80ä»¥ä¸Š â†’ ç·‘
        - 60ã€œ79 â†’ é»„
        - 60æœªæº€ â†’ èµ¤

---

### 1-5. æ‹¡å¼µKPIãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹åˆ¶å¾¡

### 1-5-1. `kpi_metrics_enabled_keys`

- å‹: `string[]`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `[]`ï¼ˆåˆæœŸã¯ç©ºï¼‰
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è¡¨ç¤ºå¯¾è±¡ã¨ã™ã‚‹ `shop_kpi_metrics.metric_key` ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã€‚
    - ä¾‹ï¼š`["trial_to_subscription_rate","second_visit_rate"]` ãªã©ã€‚

---

### 1-5-2. `kpi_metrics_experimental_keys`

- å‹: `string[]`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `[]`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - è©¦é¨“é‹ç”¨ä¸­ã®æŒ‡æ¨™ã‚’æŒ‡å®šã™ã‚‹ãƒªã‚¹ãƒˆã€‚
    - ç®¡ç†ç”»é¢ä¸Šã§ã¯ã€Œå®Ÿé¨“ä¸­ã€ã€Œå‚è€ƒå€¤ã€ãªã©ã®ãƒ©ãƒ™ãƒ«ã§è¡¨ç¤ºã—ãŸã„éš›ã«åˆ©ç”¨ã™ã‚‹ã€‚

---

### 1-6. ãƒ‡ãƒ¼ã‚¿ä¿æŒï¼åŒ¿ååŒ–

### 1-6-1. `kpi_anonymous_aggregation_enabled`

- å‹: `bool`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: `true`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - å¯èƒ½ãªé™ã‚Š `sys_events` ç­‰ã®åŒ¿ååŒ–ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰KPIé›†è¨ˆã‚’è¡Œã†ã‹ã©ã†ã‹ã€‚
    - `false` ã«ã—ãŸå ´åˆã€`sales_records` ã‚„ `tickets` ã‚’ç›´æ¥é›†è¨ˆã™ã‚‹å®Ÿè£…ã‚’è¨±å®¹ã™ã‚‹ã€‚

---

### 1-6-2. `kpi_data_retention_months`

- å‹: `int`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä¾‹: `36`
- ã‚¹ã‚³ãƒ¼ãƒ—: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“
- èª¬æ˜:
    - `shop_kpis` ãŠã‚ˆã³ `shop_kpi_metrics` ã‚’ä¿æŒã—ã¦ãŠãæœŸé–“ï¼ˆæœˆæ•°ï¼‰ã€‚
    - è¶…éåˆ†ã¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¾ãŸã¯å‰Šé™¤ã™ã‚‹ï¼ˆå…·ä½“ã¯Phase7 CRON_SYSã§å®šç¾©ï¼‰ã€‚

---

## 2. å®Ÿè£…ãƒ¡ãƒ¢ï¼ˆsys_params ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°æ–¹é‡ä¾‹ï¼‰

- `sys_params` ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã€ã‚­ãƒ¼ã¯ `kpi.<param_key>` ã®ã‚ˆã†ã« prefix ã‚’ä»˜ã‘ã‚‹ã€‚

| param_key | sys_params.key | ä¾‹value |
| --- | --- | --- |
| kpi_default_granularity | `kpi.default_granularity` | `"monthly"` |
| kpi_default_period_months | `kpi.default_period_months` | `3` |
| kpi_allow_daily | `kpi.allow_daily` | `false` |
| kpi_ai_good_resolution_threshold | `kpi.ai_good_resolution_threshold` | `0.7` |
| kpi_ai_bad_resolution_threshold | `kpi.ai_bad_resolution_threshold` | `0.4` |
| kpi_customer_ticket_high_threshold | `kpi.customer_ticket_high_threshold` | `50` |
| kpi_sla_good_threshold | `kpi.sla_good_threshold` | `0.9` |
| kpi_sla_bad_threshold | `kpi.sla_bad_threshold` | `0.7` |
| kpi_first_response_target_minutes | `kpi.first_response_target_minutes` | `60` |
| kpi_score_sales_weight | `kpi.score_sales_weight` | `0.5` |
| kpi_score_support_weight | `kpi.score_support_weight` | `0.5` |
| kpi_score_overall_good_threshold | `kpi.score_overall_good_threshold` | `80` |
| kpi_score_overall_warning_threshold | `kpi.score_overall_warning_threshold` | `60` |
| kpi_metrics_enabled_keys | `kpi.metrics_enabled_keys` | `[]` |
| kpi_metrics_experimental_keys | `kpi.metrics_experimental_keys` | `[]` |
| kpi_anonymous_aggregation_enabled | `kpi.anonymous_aggregation_enabled` | `true` |
| kpi_data_retention_months | `kpi.data_retention_months` | `36` |

---

## 3. æ±ºå®šäº‹é … / æœªæ±ºäº‹é … / è«–ç‚¹

### 3-1. æ±ºå®šäº‹é …

- KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®æŒ™å‹•ãƒ»è‰²åˆ†ã‘ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã¯ã€ã“ã“ã§å®šç¾©ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¾¤ã‚’åŸºæº–ã¨ã—ã¦åˆ¶å¾¡ã™ã‚‹ã€‚
- `kpi_score_overall` ã®ã€Œè‰¯å¥½ï¼è¦æ³¨æ„ã€åˆ¤å®šã« `kpi_score_overall_good_threshold`ï¼`kpi_score_overall_warning_threshold` ã‚’ç”¨ã„ã‚‹ã€‚
- æ‹¡å¼µKPIã®è¡¨ç¤ºåˆ¶å¾¡ã¯ `kpi_metrics_enabled_keys`ï¼`kpi_metrics_experimental_keys` ã§è¡Œã†ã€‚

### 3-2. æœªæ±ºäº‹é …

- `kpi_customer_ticket_high_threshold` ã®å…·ä½“å€¤ï¼ˆ50ä»¶ãŒå¦¥å½“ã‹ï¼‰ã¯ã€å®Ÿéš›ã®å•ã„åˆã‚ã›ä»¶æ•°ã®åˆ†å¸ƒã‚’è¦‹ã¦èª¿æ•´ãŒå¿…è¦ã€‚
- `kpi_ai_good_resolution_threshold`ï¼`kpi_ai_bad_resolution_threshold` ãŒé‹ç”¨ä¸Šã—ã£ãã‚Šæ¥ã‚‹ã‹ã©ã†ã‹ã€‚

### 3-3. è«–ç‚¹

- åº—èˆ—ã”ã¨ï¼ã‚ªãƒ¼ãƒŠãƒ¼ã”ã¨ã«ã—ãã„å€¤ã‚’å¤‰ãˆãŸã„è¦æœ›ãŒå‡ºãŸå ´åˆã€
per-shop/per-owner override ã‚’ã©ã†è¨­è¨ˆã™ã‚‹ã‹ï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ« or ä¸Šæ›¸ããƒ­ã‚¸ãƒƒã‚¯ãªã©ï¼‰ã€‚
- å°†æ¥çš„ã«ã€Œå››åŠæœŸã€ã€Œå¹´åº¦ã€å˜ä½ã®KPIã‚’æ‰±ã†å ´åˆã€
åˆ¥é€” `kpi_default_granularity` ã« `quarterly` ç­‰ã‚’è¿½åŠ ã™ã‚‹ã‹ã€UIå´ã§è§£é‡ˆã™ã‚‹ã‹ã€‚
